<?xml version="1.0" encoding="UTF-8"?>
<tasklist name="Install GNUnet on PlanetLab node" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../tasklist_schema.xsd">
	
	<run id="0" name="check peer">
		<!-- Check if peer is working -->
        <command>sudo date</command> 
        <arguments></arguments> 
        <timeout>10</timeout>
        <expected_return_code>0</expected_return_code>
        <expected_output>2013</expected_output>
        <stop_on_fail>true</stop_on_fail>
	</run> 

<sequence name="GNUnet preinstallation and subversion" enabled="true">
    <run id="30" name="Install dependencies with yum : subversion">
          <command>sudo yum -y -t --nogpgcheck install</command> 
          <arguments>subversion</arguments> 
          <timeout>0</timeout> 
          <expected_return_code>0</expected_return_code>
          <expected_output></expected_output>
          <stop_on_fail>false</stop_on_fail>
    </run>
    <run id="31" name="Download GNUnet svn certificate">
          <command>wget --no-check-certificate</command> 
          <arguments>https://gnunet.org/svn/gnunet-planetlab/gplmt/contrib/gnunet-svn-cert</arguments> 
          <timeout>0</timeout> 
          <expected_return_code>-1</expected_return_code>
          <expected_output></expected_output>
          <stop_on_fail>false</stop_on_fail>
    </run> 
    <run id="32" name="Install GNUnet svn certificate">
          <command>mkdir .subversion; mkdir .subversion/auth; mkdir .subversion/auth/svn.ssl.server; cp gnunet-svn-cert .subversion/auth/svn.ssl.server/2bd0c10624fe8b217987bb45f1ec55bf</command> 
          <arguments></arguments> 
          <timeout>0</timeout> 
          <expected_return_code>-1</expected_return_code>
          <expected_output></expected_output>
          <stop_on_fail>false</stop_on_fail>
    </run> 
   <!-- GNUnet preinstallation and subversion end -->       
</sequence>	

<sequence name="Install GNUnet from SVN" enabled="true">
	  <run id="131" name="Download GNUnet">
	        <command>svn checkout</command> 
	        <arguments> https://gnunet.org/svn/gnunet</arguments> 
	        <timeout>0</timeout> 
	        <expected_return_code>0</expected_return_code>
	        <expected_output></expected_output>
	        <stop_on_fail>true</stop_on_fail>
	  </run>
	  <run id="131" name="SVN up GNUnet">
	        <command>cd gnunet; svn up</command> 
	        <arguments></arguments> 
	        <timeout>0</timeout> 
	        <expected_return_code>0</expected_return_code>
	        <expected_output></expected_output>
	        <stop_on_fail>true</stop_on_fail>
	  </run>
	  <run id="132" name="Bootstrap GNUnet" enabled="true">
	        <command>cd gnunet; libtoolize; ./bootstrap</command> 
	        <arguments></arguments> 
	        <timeout>0</timeout> 
	        <expected_return_code>0</expected_return_code>
	        <expected_output></expected_output>
	        <stop_on_fail>true</stop_on_fail>
	  </run>
	  <run id="133" name="Configure GNUnet" enabled="true">
	        <command>cd gnunet; export LD_LIBRARY_PATH=/usr/local/lib; ./configure </command> 
	        <arguments>--prefix=$HOME/gnbuild --with-extractor=/usr/local  --with-curl=/usr/local --with-mysql=/usr/lib/mysql --enable-logging=verbose</arguments> 
	        <timeout>0</timeout> 
	        <expected_return_code>0</expected_return_code>
	        <expected_output></expected_output>
	        <stop_on_fail>true</stop_on_fail>
	  </run>
	  <run id="134" name="Install GNUnet">
	        <command>cd gnunet; export LD_LIBRARY_PATH=/usr/local/lib; make install</command>
	        <arguments> </arguments> 
	        <timeout>0</timeout> 
	        <expected_return_code>0</expected_return_code>
	        <expected_output></expected_output>
	        <stop_on_fail>true</stop_on_fail>
	  </run>
 </sequence>
 
 
 <sequence name="Postinstallation setup" enabled="true">
  <run id="141" name="Create GNUnet directory" enabled="true">
        <command>mkdir .gnunet; touch .gnunet/gnunet.conf</command> 
        <arguments></arguments> 
        <timeout>0</timeout> 
        <expected_return_code>0</expected_return_code>
        <expected_output></expected_output>
        <stop_on_fail>true</stop_on_fail>
  </run>
  <run id="142" name="Set GNUNET_PREFIX" enabled="true">
        <command>echo -e "export GNUNET_PREFIX=$HOME/gnbuild \n" >> ~/.bashrc</command> 
        <arguments></arguments> 
        <timeout>0</timeout> 
        <expected_return_code>0</expected_return_code>
        <expected_output></expected_output>
        <stop_on_fail>true</stop_on_fail>
  </run>
  <run id="143" name="Configure GNUnet" enabled="true">
        <command>echo -e "export PATH=$PATH:$GNUNET_PREFIX/bin \n" >> ~/.bashrc</command> 
        <arguments></arguments> 
        <timeout>0</timeout> 
        <expected_return_code>0</expected_return_code>
        <expected_output></expected_output>
        <stop_on_fail>true</stop_on_fail>
  </run>
</sequence>	    
</tasklist>
