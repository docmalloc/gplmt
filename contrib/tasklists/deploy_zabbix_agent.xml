<?xml version="1.0" encoding="UTF-8"?>
<tasklist name="Deploy zabbix agent" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../tasklist_schema.xsd">
	
	<run id="0" name="check peer">
		<!-- Check if peer is working -->
        <command>sudo date</command> 
        <arguments></arguments> 
        <timeout>10</timeout>
        <expected_return_code>0</expected_return_code>
        <expected_output>2013</expected_output>
        <stop_on_fail>true</stop_on_fail>
	</run>
	
	<sequence enabled="true">
	    <run id="0" name="kill any running zabbix agent">
            <command>killall</command> 
            <arguments>zabbix_agentd</arguments> 
            <timeout>0</timeout>
            <expected_return_code>0</expected_return_code>
            <expected_output></expected_output>
            <stop_on_fail>false</stop_on_fail>
	    </run>
	    
	    <run id="1" name="create zabbix directory">
            <command>mkdir</command> 
            <arguments>zabbix</arguments> 
            <timeout>0</timeout>
            <expected_return_code>0</expected_return_code>
            <expected_output></expected_output>
            <stop_on_fail>false</stop_on_fail>
	    </run>

	    <run id="2" name="download source 2.0.4">
            <command>cd zabbix; wget</command> 
            <arguments>http://iweb.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/2.0.4/zabbix-2.0.4.tar.gz</arguments> 
            <timeout>0</timeout>
            <expected_return_code>0</expected_return_code>
            <expected_output></expected_output>
            <stop_on_fail>false</stop_on_fail>
	    </run>
	
	    <run id="3" name="unzip source">
            <command>cd zabbix; tar -xvzf</command> 
            <arguments>zabbix-2.0.4.tar.gz</arguments> 
            <timeout>0</timeout>
            <expected_return_code>0</expected_return_code>
            <expected_output></expected_output>
            <stop_on_fail>false</stop_on_fail>
	    </run>
	
	    <run id="4" name="configure">
            <command>cd zabbix/zabbix-2.0.4; ./configure --enable-agent</command> 
            <arguments></arguments> 
            <timeout>0</timeout>
            <expected_return_code>0</expected_return_code>
            <expected_output></expected_output>
            <stop_on_fail>false</stop_on_fail>
	    </run>
	
	    <run id="5" name="install make">
            <command>sudo yum -y -t --nogpgcheck install</command> 
            <arguments>make</arguments> 
            <timeout>0</timeout>
            <expected_return_code>0</expected_return_code>
            <expected_output></expected_output>
            <stop_on_fail>false</stop_on_fail>
	    </run>
	
	    <run id="6" name="make install">
            <command>cd zabbix/zabbix-2.0.4; sudo make install</command> 
            <arguments></arguments> 
            <timeout>0</timeout>
            <expected_return_code>0</expected_return_code>
            <expected_output></expected_output>
            <stop_on_fail>false</stop_on_fail>
	    </run>
	
	    <run id="7" name="create /etc/zabbix dir">
            <command>sudo mkdir</command> 
            <arguments>/etc/zabbix/</arguments> 
            <timeout>0</timeout>
            <expected_return_code>0</expected_return_code>
            <expected_output></expected_output>
            <stop_on_fail>false</stop_on_fail>
	    </run>
	
	    <put id="8" name="put zabbix_agentd.conf">
		    <source>contrib/zabbix_agentd.conf</source>
		    <destination>~/zabbix/zabbix_agentd.conf</destination>
		    <stop_on_fail>false</stop_on_fail>
	    </put>
	
	    <run id="9" name="move conf file">
            <command>sudo mv zabbix/zabbix_agentd.conf</command> 
            <arguments>~/zabbix_agentd.conf</arguments> 
            <timeout>0</timeout>
            <expected_return_code>0</expected_return_code>
            <expected_output></expected_output>
            <stop_on_fail>false</stop_on_fail>
	    </run>
	
	    <run id="10" name="start agent">
            <command>/usr/local/sbin/zabbix_agentd -c ~/zabbix_agentd.conf</command> 
            <arguments></arguments> 
            <timeout>0</timeout>
            <expected_return_code>0</expected_return_code>
            <expected_output></expected_output>
            <stop_on_fail>true</stop_on_fail>
	    </run>
    </sequence>
</tasklist>
